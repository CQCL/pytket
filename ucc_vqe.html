

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>VQE for Unitary Coupled Cluster using tket &#8212; pytket examples</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ucc_vqe';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Symbolic circuits with qujax and pytket-qujax" href="pytket-qujax_qaoa.html" />
    <link rel="prev" title="Symbolic compilation" href="symbolics_example.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/Quantinuum_logo_black.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/Quantinuum_logo_white.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ansatz_sequence_example.html">Ansatz Sequencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="circuit_analysis_example.html">Circuit analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="circuit_generation_example.html">Circuit generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="compilation_example.html">Compilation passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditional_gate_example.html">Conditional Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="contextual_optimization.html">Contextual optimisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_backends.html">How to create your own <code class="docutils literal notranslate"><span class="pre">Backend</span></code> using <code class="docutils literal notranslate"><span class="pre">pytket</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="measurement_reduction_example.html">Advanced Expectation Values and Measurement Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapping_example.html">Qubit Mapping and Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="symbolics_example.html">Symbolic compilation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">VQE for Unitary Coupled Cluster using tket</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax_qaoa.html">Symbolic circuits with <code class="docutils literal notranslate"><span class="pre">qujax</span></code> and <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code><br/></a></li>



<li class="toctree-l1"><a class="reference internal" href="benchmarking/README.html">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends_example.html">TKET Backend Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparing_simulators.html">Comparison of the simulators available through tket</a></li>
<li class="toctree-l1"><a class="reference internal" href="qiskit_integration.html">Integrating <code class="docutils literal notranslate"><span class="pre">pytket</span></code> into Qiskit software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Forest_portability_example.html">Code Portability and Intro to Forest</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax-classification.html">Binary Classification using pytket-qujax</a></li>




<li class="toctree-l1"><a class="reference internal" href="expectation_value_example.html">Expectation Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="entanglement_swapping.html">Iterated Entanglement Swapping using tket</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytket-qujax_heisenberg_vqe.html">Letâ€™s start with a tket circuit<br/></a></li>





<li class="toctree-l1"><a class="reference internal" href="spam_example.html">Calibration and Correction of State Preparation and Measurement (SPAM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tket_benchmarking.html">tket benchmarking example</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ucc_vqe.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>VQE for Unitary Coupled Cluster using tket</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="vqe-for-unitary-coupled-cluster-using-tket">
<h1>VQE for Unitary Coupled Cluster using tket<a class="headerlink" href="#vqe-for-unitary-coupled-cluster-using-tket" title="Permalink to this heading">#</a></h1>
<p>In this tutorial, we will focus on:<br></p>
<ul class="simple">
<li><p>building parameterised ansÃ¤tze for variational algorithms;<br></p></li>
<li><p>compilation tools for UCC-style ansÃ¤tze.</p></li>
</ul>
<p>This example assumes the reader is familiar with the Variational Quantum Eigensolver and its application to electronic structure problems through the Unitary Coupled Cluster approach.<br>
<br>
To run this example, you will need <code class="docutils literal notranslate"><span class="pre">pytket</span></code> and <code class="docutils literal notranslate"><span class="pre">pytket-qiskit</span></code>, as well as <code class="docutils literal notranslate"><span class="pre">openfermion</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code>, and <code class="docutils literal notranslate"><span class="pre">sympy</span></code>.<br>
<br>
We will start with a basic implementation and then gradually modify it to make it faster, more general, and less noisy. The final solution is given in full at the bottom of the notebook.<br>
<br>
Suppose we have some electronic configuration problem, expressed via a physical Hamiltonian. (The Hamiltonian and excitations in this example were obtained using <code class="docutils literal notranslate"><span class="pre">qiskit-aqua</span></code> version 0.5.2 and <code class="docutils literal notranslate"><span class="pre">pyscf</span></code> for H2, bond length 0.75A, sto3g basis, Jordan-Wigner encoding, with no qubit reduction or orbital freezing.). We express it succinctly using the openfermion library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openfermion</span> <span class="k">as</span> <span class="nn">of</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hamiltonian</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">-</span><span class="mf">0.8153001706270075</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16988452027940318</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="o">-</span><span class="mf">0.21886306781219608</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16988452027940323</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z2&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="o">-</span><span class="mf">0.2188630678121961</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.12005143072546047</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0 Z1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16821198673715723</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0 Z2&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16549431486978672</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0 Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16549431486978672</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z1 Z2&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.1739537877649417</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z1 Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.12005143072546047</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z2 Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;X0 X1 X2 X3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;X0 X1 Y2 Y3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Y0 Y1 X2 X3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Y0 Y1 Y2 Y3&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">nuclear_repulsion_energy</span> <span class="o">=</span> <span class="mf">0.70556961456</span>
</pre></div>
</div>
</div>
</div>
<p>We would like to define our ansatz for arbitrary parameter values. For simplicity, letâ€™s start with a Hardware Efficient Ansatz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">Circuit</span>
</pre></div>
</div>
</div>
</div>
<p>Hardware efficient ansatz:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hea</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">ansatz</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ansatz</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">ansatz</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ansatz</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ansatz</span>
</pre></div>
</div>
</div>
</div>
<p>We can use this to build the objective function for our optimisation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.extensions.qiskit</span> <span class="kn">import</span> <span class="n">AerBackend</span>
<span class="kn">from</span> <span class="nn">pytket.utils.expectations</span> <span class="kn">import</span> <span class="n">expectation_from_counts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span> <span class="o">=</span> <span class="n">AerBackend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Naive objective function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">hamiltonian</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">term</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="n">coeff</span>
            <span class="k">continue</span>
        <span class="n">circ</span> <span class="o">=</span> <span class="n">hea</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">add_c_register</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">term</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">pauli</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pauli</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                <span class="n">circ</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">pauli</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="n">circ</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">circ</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">compiled_circ</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">get_compiled_circuit</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run_circuit</span><span class="p">(</span><span class="n">compiled_circ</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
        <span class="n">energy</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">expectation_from_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">energy</span> <span class="o">+</span> <span class="n">nuclear_repulsion_energy</span>
</pre></div>
</div>
</div>
</div>
<p>This objective function is then run through a classical optimiser to find the set of parameter values that minimise the energy of the system. For the sake of example, we will just run this with a single parameter value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arg_values</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">-</span><span class="mf">7.31158201e-02</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.64514836e-04</span><span class="p">,</span>
    <span class="mf">1.12585591e-03</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">2.58367544e-03</span><span class="p">,</span>
    <span class="mf">1.00006068e00</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.19551357e-03</span><span class="p">,</span>
    <span class="mf">9.99963988e-01</span><span class="p">,</span>
    <span class="mf">2.53283285e-03</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy</span> <span class="o">=</span> <span class="n">objective</span><span class="p">(</span><span class="n">arg_values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-1.1381410514835153
</pre></div>
</div>
</div>
</div>
<p>The HEA is designed to cram as many orthogonal degrees of freedom into a small circuit as possible to be able to explore a large region of the Hilbert space whilst the circuits themselves can be run with minimal noise. These ansÃ¤tze give virtually-optimal circuits by design, but suffer from an excessive number of variational parameters making convergence slow, barren plateaus where the classical optimiser fails to make progress, and spanning a space where most states lack a physical interpretation. These drawbacks can necessitate adding penalties and may mean that the ansatz cannot actually express the true ground state.<br>
<br>
The UCC ansatz, on the other hand, is derived from the electronic configuration. It sacrifices efficiency of the circuit for the guarantee of physical states and the variational parameters all having some meaningful effect, which helps the classical optimisation to converge.<br>
<br>
This starts by defining the terms of our single and double excitations. These would usually be generated using the orbital configurations, so we will just use a hard-coded example here for the purposes of demonstration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">Qubit</span>
<span class="kn">from</span> <span class="nn">pytket.pauli</span> <span class="kn">import</span> <span class="n">Pauli</span><span class="p">,</span> <span class="n">QubitPauliString</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qubit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">xyii</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">yxii</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">iixy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">iiyx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">xxxy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">xxyx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">xyxx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">yxxx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">yyyx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">yyxy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">yxyy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">xyyy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">singles_a</span> <span class="o">=</span> <span class="p">{</span><span class="n">xyii</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">yxii</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">}</span>
<span class="n">singles_b</span> <span class="o">=</span> <span class="p">{</span><span class="n">iixy</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">iiyx</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">}</span>
<span class="n">doubles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">xxxy</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">xxyx</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">xyxx</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">yxxx</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">yyyx</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">yyxy</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">yxyy</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">xyyy</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Building the ansatz circuit itself is often done naively by defining the map from each term down to basic gates and then applying it to each term.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_operator_term</span><span class="p">(</span><span class="n">circuit</span><span class="p">:</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">term</span><span class="p">:</span> <span class="n">QubitPauliString</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="n">qubits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">term</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">I</span><span class="p">:</span>
            <span class="n">qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="n">circuit</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="n">circuit</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">circuit</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">circuit</span><span class="o">.</span><span class="n">CX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">term</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="n">circuit</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="n">circuit</span><span class="o">.</span><span class="n">Vdg</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Unitary Coupled Cluster Singles &amp; Doubles ansatz:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ucc</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">ansatz</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="c1"># Set initial reference state</span>
    <span class="n">ansatz</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># Evolve by excitations</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">singles_a</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_operator_term</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">singles_b</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_operator_term</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">doubles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_operator_term</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ansatz</span>
</pre></div>
</div>
</div>
</div>
<p>This is already quite verbose, but <code class="docutils literal notranslate"><span class="pre">pytket</span></code> has a neat shorthand construction for these operator terms using the <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code> construction. We can then decompose these into basic gates using the <code class="docutils literal notranslate"><span class="pre">DecomposeBoxes</span></code> compiler pass.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">PauliExpBox</span>
<span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="n">DecomposeBoxes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_excitation</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">term_dict</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">term_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">qubits</span><span class="p">,</span> <span class="n">paulis</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">term</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">pbox</span> <span class="o">=</span> <span class="n">PauliExpBox</span><span class="p">(</span><span class="n">paulis</span><span class="p">,</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">param</span><span class="p">)</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">add_pauliexpbox</span><span class="p">(</span><span class="n">pbox</span><span class="p">,</span> <span class="n">qubits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>UCC ansatz with syntactic shortcuts:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ucc</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">ansatz</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">ansatz</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">add_excitation</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">singles_a</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">add_excitation</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">singles_b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">add_excitation</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">doubles</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">DecomposeBoxes</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ansatz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ansatz</span>
</pre></div>
</div>
</div>
</div>
<p>The objective function can also be simplified using a utility method for constructing the measurement circuits and processing for expectation value calculations. For that, we convert the Hamiltonian to a pytket QubitPauliOperator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.utils.operators</span> <span class="kn">import</span> <span class="n">QubitPauliOperator</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pauli_sym</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;I&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">qps_from_openfermion</span><span class="p">(</span><span class="n">paulis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert OpenFermion tensor of Paulis to pytket QubitPauliString.&quot;&quot;&quot;</span>
    <span class="n">qlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paulis</span><span class="p">:</span>
        <span class="n">qlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Qubit</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pauli_sym</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">qlist</span><span class="p">,</span> <span class="n">plist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">qpo_from_openfermion</span><span class="p">(</span><span class="n">openf_op</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert OpenFermion QubitOperator to pytket QubitPauliOperator.&quot;&quot;&quot;</span>
    <span class="n">tk_op</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">openf_op</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">qps_from_openfermion</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="n">tk_op</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span>
    <span class="k">return</span> <span class="n">QubitPauliOperator</span><span class="p">(</span><span class="n">tk_op</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hamiltonian_op</span> <span class="o">=</span> <span class="n">qpo_from_openfermion</span><span class="p">(</span><span class="n">hamiltonian</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Simplified objective function using utilities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.utils.expectations</span> <span class="kn">import</span> <span class="n">get_operator_expectation_value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">ucc</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">get_operator_expectation_value</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">hamiltonian_op</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">nuclear_repulsion_energy</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arg_values</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.79002933e-05</span><span class="p">,</span> <span class="mf">2.42964799e-05</span><span class="p">,</span> <span class="mf">4.63447157e-01</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy</span> <span class="o">=</span> <span class="n">objective</span><span class="p">(</span><span class="n">arg_values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-1.135140542855153+0j)
</pre></div>
</div>
</div>
</div>
<p>This is now the simplest form that this operation can take, but it isnâ€™t necessarily the most effective. When we decompose the ansatz circuit into basic gates, it is still very expensive. We can employ some of the circuit simplification passes available in <code class="docutils literal notranslate"><span class="pre">pytket</span></code> to reduce its size and improve fidelity in practice.<br>
<br>
A good example is to decompose each <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code> into basic gates and then apply <code class="docutils literal notranslate"><span class="pre">FullPeepholeOptimise</span></code>, which defines a compilation strategy utilising all of the simplifications in <code class="docutils literal notranslate"><span class="pre">pytket</span></code> that act locally on small regions of a circuit. We can examine the effectiveness by looking at the number of two-qubit gates before and after simplification, which tends to be a good indicator of fidelity for near-term systems where these gates are often slow and inaccurate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket</span> <span class="kn">import</span> <span class="n">OpType</span>
<span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="n">FullPeepholeOptimise</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_circuit</span> <span class="o">=</span> <span class="n">ucc</span><span class="p">(</span><span class="n">arg_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX count before&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">n_gates_of_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX depth before&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">depth_by_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CX count before 56
CX depth before 36
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FullPeepholeOptimise</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX count after FPO&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">n_gates_of_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX depth after FPO&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">depth_by_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CX count after FPO 26
CX depth after FPO 23
</pre></div>
</div>
</div>
</div>
<p>These simplification techniques are very general and are almost always beneficial to apply to a circuit if you want to eliminate local redundancies. But UCC ansÃ¤tze have extra structure that we can exploit further. They are defined entirely out of exponentiated tensors of Pauli matrices, giving the regular structure described by the <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code>es. Under many circumstances, it is more efficient to not synthesise these constructions individually, but simultaneously in groups. The <code class="docutils literal notranslate"><span class="pre">PauliSimp</span></code> pass finds the description of a given circuit as a sequence of <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code>es and resynthesises them (by default, in groups of commuting terms). This can cause great change in the overall structure and shape of the circuit, enabling the identification and elimination of non-local redundancy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="n">PauliSimp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_circuit</span> <span class="o">=</span> <span class="n">ucc</span><span class="p">(</span><span class="n">arg_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX count before&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">n_gates_of_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX depth before&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">depth_by_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CX count before 56
CX depth before 36
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PauliSimp</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX count after PS&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">n_gates_of_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX depth after PS&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">depth_by_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CX count after PS 26
CX depth after PS 19
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FullPeepholeOptimise</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX count after PS+FPO&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">n_gates_of_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CX depth after PS+FPO&quot;</span><span class="p">,</span> <span class="n">test_circuit</span><span class="o">.</span><span class="n">depth_by_type</span><span class="p">(</span><span class="n">OpType</span><span class="o">.</span><span class="n">CX</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CX count after PS+FPO 15
CX depth after PS+FPO 12
</pre></div>
</div>
</div>
</div>
<p>To include this into our routines, we can just add the simplification passes to the objective function. The <code class="docutils literal notranslate"><span class="pre">get_operator_expectation_value</span></code> utility handles compiling to meet the requirements of the backend, so we donâ€™t have to worry about that here.</p>
<p>Objective function with circuit simplification:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">ucc</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">PauliSimp</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
    <span class="n">FullPeepholeOptimise</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">get_operator_expectation_value</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">hamiltonian_op</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">nuclear_repulsion_energy</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These circuit simplification techniques have tried to preserve the exact unitary of the circuit, but there are ways to change the unitary whilst preserving the correctness of the algorithm as a whole.<br>
<br>
For example, the excitation terms are generated by trotterisation of the excitation operator, and the order of the terms does not change the unitary in the limit of many trotter steps, so in this sense we are free to sequence the terms how we like and it is sensible to do this in a way that enables efficient synthesis of the circuit. Prioritising collecting terms into commuting sets is a very beneficial heuristic for this and can be performed using the <code class="docutils literal notranslate"><span class="pre">gen_term_sequence_circuit</span></code> method to group the terms together into collections of <code class="docutils literal notranslate"><span class="pre">PauliExpBox</span></code>es and the <code class="docutils literal notranslate"><span class="pre">GuidedPauliSimp</span></code> pass to utilise these sets for synthesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="n">GuidedPauliSimp</span>
<span class="kn">from</span> <span class="nn">pytket.utils</span> <span class="kn">import</span> <span class="n">gen_term_sequence_circuit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ucc</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">singles_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">qps</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="k">for</span> <span class="n">qps</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">singles</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">doubles_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">qps</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="k">for</span> <span class="n">qps</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">doubles</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">excitation_op</span> <span class="o">=</span> <span class="n">QubitPauliOperator</span><span class="p">({</span><span class="o">**</span><span class="n">singles_params</span><span class="p">,</span> <span class="o">**</span><span class="n">doubles_params</span><span class="p">})</span>
    <span class="n">reference_circ</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ansatz</span> <span class="o">=</span> <span class="n">gen_term_sequence_circuit</span><span class="p">(</span><span class="n">excitation_op</span><span class="p">,</span> <span class="n">reference_circ</span><span class="p">)</span>
    <span class="n">GuidedPauliSimp</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ansatz</span><span class="p">)</span>
    <span class="n">FullPeepholeOptimise</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ansatz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ansatz</span>
</pre></div>
</div>
</div>
</div>
<p>Adding these simplification routines doesnâ€™t come for free. Compiling and simplifying the circuit to achieve the best results possible can be a difficult task, which can take some time for the classical computer to perform.<br>
<br>
During a VQE run, we will call this objective function many times and run many measurement circuits within each, but the circuits that are run on the quantum computer are almost identical, having the same gate structure but with different gate parameters and measurements. We have already exploited this within the body of the objective function by simplifying the ansatz circuit before we call <code class="docutils literal notranslate"><span class="pre">get_operator_expectation_value</span></code>, so it is only done once per objective calculation rather than once per measurement circuit.<br>
<br>
We can go even further by simplifying it once outside of the objective function, and then instantiating the simplified ansatz with the parameter values needed. For this, we will construct the UCC ansatz circuit using symbolic (parametric) gates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span>
</pre></div>
</div>
</div>
</div>
<p>Symbolic UCC ansatz generation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">syms</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;p0 p1 p2&quot;</span><span class="p">)</span>
<span class="n">singles_a_syms</span> <span class="o">=</span> <span class="p">{</span><span class="n">qps</span><span class="p">:</span> <span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="k">for</span> <span class="n">qps</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">singles_a</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">singles_b_syms</span> <span class="o">=</span> <span class="p">{</span><span class="n">qps</span><span class="p">:</span> <span class="n">syms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="k">for</span> <span class="n">qps</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">singles_b</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">doubles_syms</span> <span class="o">=</span> <span class="p">{</span><span class="n">qps</span><span class="p">:</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="k">for</span> <span class="n">qps</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">doubles</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">excitation_op</span> <span class="o">=</span> <span class="n">QubitPauliOperator</span><span class="p">({</span><span class="o">**</span><span class="n">singles_a_syms</span><span class="p">,</span> <span class="o">**</span><span class="n">singles_b_syms</span><span class="p">,</span> <span class="o">**</span><span class="n">doubles_syms</span><span class="p">})</span>
<span class="n">ucc_ref</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ucc</span> <span class="o">=</span> <span class="n">gen_term_sequence_circuit</span><span class="p">(</span><span class="n">excitation_op</span><span class="p">,</span> <span class="n">ucc_ref</span><span class="p">)</span>
<span class="n">GuidedPauliSimp</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ucc</span><span class="p">)</span>
<span class="n">FullPeepholeOptimise</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ucc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Objective function using the symbolic ansatz:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">ucc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">sym_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="n">circ</span><span class="o">.</span><span class="n">symbol_substitution</span><span class="p">(</span><span class="n">sym_map</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">get_operator_expectation_value</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">hamiltonian_op</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">n_shots</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">nuclear_repulsion_energy</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We have now got some very good use of <code class="docutils literal notranslate"><span class="pre">pytket</span></code> for simplifying each individual circuit used in our experiment and for minimising the amount of time spent compiling, but there is still more we can do in terms of reducing the amount of work the quantum computer has to do. Currently, each (non-trivial) term in our measurement hamiltonian is measured by a different circuit within each expectation value calculation. Measurement reduction techniques exist for identifying when these observables commute and hence can be simultaneously measured, reducing the number of circuits required for the full expectation value calculation.<br>
<br>
This is built in to the <code class="docutils literal notranslate"><span class="pre">get_operator_expectation_value</span></code> method and can be applied by specifying a way to partition the measuremrnt terms. <code class="docutils literal notranslate"><span class="pre">PauliPartitionStrat.CommutingSets</span></code> can greatly reduce the number of measurement circuits by combining any number of terms that mutually commute. However, this involves potentially adding an arbitrary Clifford circuit to change the basis of the measurements which can be costly on NISQ devices, so <code class="docutils literal notranslate"><span class="pre">PauliPartitionStrat.NonConflictingSets</span></code> trades off some of the reduction in circuit number to guarantee that only single-qubit gates are introduced.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.partition</span> <span class="kn">import</span> <span class="n">PauliPartitionStrat</span>
</pre></div>
</div>
</div>
</div>
<p>Objective function using measurement reduction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">ucc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">sym_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="n">circ</span><span class="o">.</span><span class="n">symbol_substitution</span><span class="p">(</span><span class="n">sym_map</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">get_operator_expectation_value</span><span class="p">(</span>
            <span class="n">circ</span><span class="p">,</span>
            <span class="n">operator</span><span class="p">,</span>
            <span class="n">backend</span><span class="p">,</span>
            <span class="n">n_shots</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
            <span class="n">partition_strat</span><span class="o">=</span><span class="n">PauliPartitionStrat</span><span class="o">.</span><span class="n">CommutingSets</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">+</span> <span class="n">nuclear_repulsion_energy</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>At this point, we have completely transformed how our VQE objective function works, improving its resilience to noise, cutting the number of circuits run, and maintaining fast runtimes. In doing this, we have explored a number of the features <code class="docutils literal notranslate"><span class="pre">pytket</span></code> offers that are beneficial to VQE and the UCC method:<br></p>
<ul class="simple">
<li><p>high-level syntactic constructs for evolution operators;<br></p></li>
<li><p>utility methods for easy expectation value calculations;<br></p></li>
<li><p>both generic and domain-specific circuit simplification methods;<br></p></li>
<li><p>symbolic circuit compilation;<br></p></li>
<li><p>measurement reduction for expectation value calculations.</p></li>
</ul>
<p>For the sake of completeness, the following gives the full code for the final solution, including passing the objective function to a classical optimiser to find the ground state:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openfermion</span> <span class="k">as</span> <span class="nn">of</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytket.extensions.qiskit</span> <span class="kn">import</span> <span class="n">AerBackend</span>
<span class="kn">from</span> <span class="nn">pytket.circuit</span> <span class="kn">import</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">Qubit</span>
<span class="kn">from</span> <span class="nn">pytket.partition</span> <span class="kn">import</span> <span class="n">PauliPartitionStrat</span>
<span class="kn">from</span> <span class="nn">pytket.passes</span> <span class="kn">import</span> <span class="n">GuidedPauliSimp</span><span class="p">,</span> <span class="n">FullPeepholeOptimise</span>
<span class="kn">from</span> <span class="nn">pytket.pauli</span> <span class="kn">import</span> <span class="n">Pauli</span><span class="p">,</span> <span class="n">QubitPauliString</span>
<span class="kn">from</span> <span class="nn">pytket.utils</span> <span class="kn">import</span> <span class="n">get_operator_expectation_value</span><span class="p">,</span> <span class="n">gen_term_sequence_circuit</span>
<span class="kn">from</span> <span class="nn">pytket.utils.operators</span> <span class="kn">import</span> <span class="n">QubitPauliOperator</span>
</pre></div>
</div>
</div>
</div>
<p>Obtain electronic Hamiltonian:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hamiltonian</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">-</span><span class="mf">0.8153001706270075</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16988452027940318</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="o">-</span><span class="mf">0.21886306781219608</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16988452027940323</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z2&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="o">-</span><span class="mf">0.2188630678121961</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.12005143072546047</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0 Z1&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16821198673715723</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0 Z2&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16549431486978672</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z0 Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.16549431486978672</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z1 Z2&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.1739537877649417</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z1 Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.12005143072546047</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Z2 Z3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;X0 X1 X2 X3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;X0 X1 Y2 Y3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Y0 Y1 X2 X3&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="mf">0.04544288414432624</span> <span class="o">*</span> <span class="n">of</span><span class="o">.</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s2">&quot;Y0 Y1 Y2 Y3&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">nuclear_repulsion_energy</span> <span class="o">=</span> <span class="mf">0.70556961456</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pauli_sym</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;I&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Z</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">qps_from_openfermion</span><span class="p">(</span><span class="n">paulis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert OpenFermion tensor of Paulis to pytket QubitPauliString.&quot;&quot;&quot;</span>
    <span class="n">qlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paulis</span><span class="p">:</span>
        <span class="n">qlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Qubit</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pauli_sym</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">qlist</span><span class="p">,</span> <span class="n">plist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">qpo_from_openfermion</span><span class="p">(</span><span class="n">openf_op</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert OpenFermion QubitOperator to pytket QubitPauliOperator.&quot;&quot;&quot;</span>
    <span class="n">tk_op</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">openf_op</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">qps_from_openfermion</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="n">tk_op</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span>
    <span class="k">return</span> <span class="n">QubitPauliOperator</span><span class="p">(</span><span class="n">tk_op</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hamiltonian_op</span> <span class="o">=</span> <span class="n">qpo_from_openfermion</span><span class="p">(</span><span class="n">hamiltonian</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Obtain terms for single and double excitations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qubit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">xyii</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">yxii</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">iixy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">iiyx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">xxxy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">xxyx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">xyxx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">yxxx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">yyyx</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">])</span>
<span class="n">yyxy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">yxyy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
<span class="n">xyyy</span> <span class="o">=</span> <span class="n">QubitPauliString</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">[</span><span class="n">Pauli</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Pauli</span><span class="o">.</span><span class="n">Y</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Symbolic UCC ansatz generation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">syms</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;p0 p1 p2&quot;</span><span class="p">)</span>
<span class="n">singles_syms</span> <span class="o">=</span> <span class="p">{</span><span class="n">xyii</span><span class="p">:</span> <span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yxii</span><span class="p">:</span> <span class="o">-</span><span class="n">syms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iixy</span><span class="p">:</span> <span class="n">syms</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">iiyx</span><span class="p">:</span> <span class="o">-</span><span class="n">syms</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
<span class="n">doubles_syms</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">xxxy</span><span class="p">:</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">xxyx</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">xyxx</span><span class="p">:</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">yxxx</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">yyyx</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">yyxy</span><span class="p">:</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">yxyy</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">xyyy</span><span class="p">:</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">syms</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">excitation_op</span> <span class="o">=</span> <span class="n">QubitPauliOperator</span><span class="p">({</span><span class="o">**</span><span class="n">singles_syms</span><span class="p">,</span> <span class="o">**</span><span class="n">doubles_syms</span><span class="p">})</span>
<span class="n">ucc_ref</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ucc</span> <span class="o">=</span> <span class="n">gen_term_sequence_circuit</span><span class="p">(</span><span class="n">excitation_op</span><span class="p">,</span> <span class="n">ucc_ref</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Circuit simplification:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GuidedPauliSimp</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ucc</span><span class="p">)</span>
<span class="n">FullPeepholeOptimise</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ucc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Connect to a simulator/device:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span> <span class="o">=</span> <span class="n">AerBackend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Objective function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="n">ucc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">sym_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="n">circ</span><span class="o">.</span><span class="n">symbol_substitution</span><span class="p">(</span><span class="n">sym_map</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">get_operator_expectation_value</span><span class="p">(</span>
            <span class="n">circ</span><span class="p">,</span>
            <span class="n">hamiltonian_op</span><span class="p">,</span>
            <span class="n">backend</span><span class="p">,</span>
            <span class="n">n_shots</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
            <span class="n">partition_strat</span><span class="o">=</span><span class="n">PauliPartitionStrat</span><span class="o">.</span><span class="n">CommutingSets</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">+</span> <span class="n">nuclear_repulsion_energy</span>
    <span class="p">)</span><span class="o">.</span><span class="n">real</span>
</pre></div>
</div>
</div>
</div>
<p>Optimise against the objective function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">4e-1</span><span class="p">]</span>
<span class="c1"># #result = minimize(objective, initial_params, method=&quot;Nelder-Mead&quot;)</span>
<span class="c1"># #print(&quot;Final parameter values&quot;, result.x)</span>
<span class="c1"># #print(&quot;Final energy value&quot;, result.fun)</span>
</pre></div>
</div>
</div>
</div>
<p>Exercises:<br></p>
<ul class="simple">
<li><p>Replace the <code class="docutils literal notranslate"><span class="pre">get_operator_expectation_value</span></code> call with its implementation and use this to pull the analysis for measurement reduction outside of the objective function, so our circuits can be fully determined and compiled once. This means that the <code class="docutils literal notranslate"><span class="pre">symbol_substitution</span></code> method will need to be applied to each measurement circuit instead of just the state preparation circuit.<br></p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">SpamCorrecter</span></code> class to add some mitigation of the measurement errors. Start by running the characterisation circuits first, before your main VQE loop, then apply the mitigation to each of the circuits run within the objective function.<br></p></li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">backend</span></code> by passing in a <code class="docutils literal notranslate"><span class="pre">Qiskit</span></code> <code class="docutils literal notranslate"><span class="pre">NoiseModel</span></code> to simulate a noisy device. Compare the accuracy of the objective function both with and without the circuit simplification. Try running a classical optimiser over the objective function and compare the convergence rates with different noise models. If you have access to a QPU, try changing the <code class="docutils literal notranslate"><span class="pre">backend</span></code> to connect to that and compare the results to the simulator.</p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="symbolics_example.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Symbolic compilation</p>
      </div>
    </a>
    <a class="right-next"
       href="pytket-qujax_qaoa.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Symbolic circuits with <code class="docutils literal notranslate"><span class="pre">qujax</span></code> and <code class="docutils literal notranslate"><span class="pre">pytket-qujax</span></code><br></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>